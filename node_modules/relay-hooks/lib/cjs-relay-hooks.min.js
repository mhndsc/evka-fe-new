"use strict";function e(e){return e&&"object"==typeof e&&"default"in e?e.default:e}Object.defineProperty(exports,"__esModule",{value:!0});var t=require("relay-runtime"),r=require("react"),n=e(r),o=e(require("fbjs/lib/areEqual"));require("fbjs/lib/warning");var i=e(require("fbjs/lib/invariant")),s=e(require("@restart/hooks/useMounted")),a=(0,t.__internal.createRelayContext)(n),u={force:!0};function l(e,r,n){return t.createOperationDescriptor(t.getRequest(e),r,n)}var c=t.__internal.fetchQuery;function f(e){var t,r,n,o,i=e.setLoading,s=e.doRetain,a=void 0===s||s,u=e.disposeTemporary,l=null,f=null,h=!1,p=null,d=function(e){h=e,i&&i(h)},v=function(){g(),f&&f.dispose(),m(),f=null,o=null,r=null},g=function(){clearTimeout(t),t=null},m=function(){l&&l.unsubscribe(),p=null};return{fetch:function(e,t,i,s,u,g){void 0===i&&(i="network-only"),void 0===s&&(s=function(e){}),o==e&&r.request.identifier===t.request.identifier||(v(),a&&(f=e.retain(t))),o=e,r=t,m();var b,y=function(e,t,r,n){if("network-only"!==r){var o=e.check(t).status,i="available"===o;if(i||"partial"===n&&"stale"!==o)return{snapshot:e.lookup(t.fragment),full:i}}return{snapshot:null,full:!1}}(e,t,i,g),R=y.snapshot,_="network-only"===(b=i)||"store-and-network"===b||"store-or-network"===b&&!y.full;if(null!=R){var P=!_;u(t,R,!0,P),P&&s(null)}if(l&&l.unsubscribe(),_){var k,q=function(){},w=function(){l===k&&(l=null),h=!1,n=null};return c(e,t).subscribe({unsubscribe:function(){w()},complete:function(){q(),d(!1),w(),s(null)},error:function(e){p=e,q(),d(!1),w(),s(e)},next:function(){var r,o=e.lookup(t.fragment);n=null,(null===(r=t.request.cacheConfig)||void 0===r?void 0:r.poll)&&d(!1),q(),u(t,o)},start:function(e){l=k=e,d(!0)}}),R||(n=new Promise((function(e){q=e}))),{dispose:function(){k&&k.unsubscribe()}}}return{dispose:function(){}}},getData:function(){return{isLoading:h,error:p}},dispose:v,checkAndSuspense:function(e,r){g();var o=n||p;if(e&&o)throw n&&r&&(t=setTimeout((function(){g(),v(),u&&u()}),3e4)),o;return o}}}var h=new Map;function p(e,t,r,n){var o=l(t,r,n),i=e&&h.has(o.request.identifier)?h.get(o.request.identifier):new v;return i.setQuery(t,r,n,o),i}var d=function(){},v=function(){function e(){var e=this;this.forceUpdate=d,this.result=null,this.retry=function(t,r){void 0===r&&(r={});var n=r.fetchPolicy,o=void 0===n?"network-only":n,i=t?l(e.query.request.node,e.query.request.variables,t):e.query;e.fetch(i,o,r),e.resolveResult(),e.forceUpdate()},this.result={retry:this.retry,error:null,data:null,isLoading:!1},this.fetcher=f({disposeTemporary:function(){e.dispose(),e.query&&h.delete(e.query.request.identifier)}})}return e.prototype.setQuery=function(e,t,r,n){this.gqlQuery=e,this.variables=t,this.query=n,this.cacheConfig=r},e.prototype.getForceUpdate=function(){return this.forceUpdate},e.prototype.setForceUpdate=function(e){this.forceUpdate=e},e.prototype.dispose=function(){this.fetcher.dispose(),this.disposeSnapshot()},e.prototype.disposeSnapshot=function(){this.snapshot=null,this.rootSubscription&&(this.rootSubscription.dispose(),this.rootSubscription=null)},e.prototype.fetch=function(e,t,r,n){var o=this;if(this.disposeSnapshot(),n)this.fetcher.dispose();else{var i=r.onComplete,s=!1;this.fetcher.fetch(this.environment,e,t,(function(e){o.resolveResult(),s&&o.forceUpdate(),i&&i(e)}),(function(e,t){o.snapshot||(o.snapshot=t,o.subscribe(t),o.resolveResult(),s&&o.forceUpdate())})),s=!0}},e.prototype.getQuery=function(e,t,r){return e==this.gqlQuery&&r==this.cacheConfig&&t==this.variables&&o(t,this.variables)?this.query:(this.variables=t,this.gqlQuery=e,this.cacheConfig=r,l(e,t,r))},e.prototype.resolveEnvironment=function(e){this.resolve(e,this.gqlQuery,this.variables,this.options)},e.prototype.resolve=function(e,t,r,n){var o=this.getQuery(t,r,n.networkCacheConfig),i=n.fetchPolicy,s=void 0===i?"store-or-network":i,a=n.fetchKey,u=n.skip;this.options=n,(!this.query||o.request.identifier!==this.query.request.identifier||e!==this.environment||s!==this.fetchPolicy||a!==this.fetchKey||u!==this.skip)&&(this.environment=e,this.query=o,this.skip=u,this.fetchPolicy=s,this.fetchKey=a,this.fetch(o,s,n,u),this.resolveResult())},e.prototype.checkAndSuspense=function(e,t){t&&(this.setForceUpdate(d),h.set(this.query.request.identifier,this));var r=this.fetcher.checkAndSuspense(e,t);return t&&h.delete(this.query.request.identifier),r},e.prototype.getData=function(){return this.result},e.prototype.resolveResult=function(){var e=this.fetcher.getData();this.result={retry:this.retry,error:e.error,data:this.snapshot?this.snapshot.data:null,isLoading:e.isLoading}},e.prototype.subscribe=function(e){var t=this;this.rootSubscription&&this.rootSubscription.dispose(),this.rootSubscription=this.environment.subscribe(e,(function(e){t.snapshot=e,t.resolveResult(),t.forceUpdate()}))},e}();function g(){return r.useReducer((function(e){return e+1}),0)[1]}function m(){return n.useContext(a).environment}var b=function(e,t,n,o){var i=m(),s=g(),a=r.useRef();null==a.current&&(a.current={queryFetcher:p(o,e,t,n.networkCacheConfig)}),r.useEffect((function(){return function(){return a.current.queryFetcher.dispose()}}),[]);var u=a.current.queryFetcher;return u.resolve(i,e,t,n),u.checkAndSuspense(o,o),u.setForceUpdate(s),u.getData()},y=function(){},R=function(e){void 0===e&&(e=!1);var t=new v;return{next:function(e,r,n,o){var i;void 0===n&&(n={}),void 0===o&&(o={}),o.networkCacheConfig=null!==(i=o.networkCacheConfig)&&void 0!==i?i:u,t.resolve(e,r,n,o);var s=t.checkAndSuspense();return s?s instanceof Error?Promise.reject(s):s:Promise.resolve()},subscribe:function(e){return t.setForceUpdate(e),function(){t.getForceUpdate()===e&&t.setForceUpdate(y)}},getValue:function(r){return t.resolveEnvironment(r),t.checkAndSuspense(e),t.getData()},dispose:function(){t.dispose(),t.setForceUpdate(y),t=new v}}},_=function(){return(_=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function P(e,t){for(var r=e,n=0,o=t;n<o.length;n++){var s=o[n];if(null==r)return null;"number"==typeof s?(Array.isArray(r)||i(!1),r=r[s]):(("object"!=typeof r||Array.isArray(r))&&i(!1),r=r[s])}return r}function k(e,r,n){var o,s;if(null==n)return{cursor:null,hasMore:!1};var a=t.ConnectionInterface.get(),u=a.EDGES,l=a.PAGE_INFO,c=a.HAS_NEXT_PAGE,f=a.HAS_PREV_PAGE,h=a.END_CURSOR,p=a.START_CURSOR;"object"!=typeof n&&i(!1);var d=n[u],v=n[l];if(null==d||null==v)return{cursor:null,hasMore:!1};Array.isArray(d)||i(!1),"object"!=typeof v&&i(!1);var g="forward"===e?null!==(o=v[h])&&void 0!==o?o:null:null!==(s=v[p])&&void 0!==s?s:null;return null!==g&&"string"!=typeof g&&i(!1),{cursor:g,hasMore:"forward"===e?null!=g&&!0===v[c]:null!=g&&!0===v[f]}}function q(e,t){var r,n;!0===(null===(r=e.metadata)||void 0===r?void 0:r.plural)&&i(!1);var o=null===(n=e.metadata)||void 0===n?void 0:n.refetch;null==o&&i(!1);var s=o.operation.default?o.operation.default:o.operation,a=o.fragmentPathInResult;"string"==typeof s&&i(!1);var u=o.identifierField;return null!=u&&"string"!=typeof u&&i(!1),{fragmentRefPathInResponse:a,identifierField:u,refetchableRequest:s,refetchMetadata:o}}function w(e,t){var r,n,o=q(e),s=o.refetchableRequest,a=o.refetchMetadata,u=a.connection;null==u&&i(!1);var l=u.path,c=(null!==(n=null===(r=e.metadata)||void 0===r?void 0:r.connection)&&void 0!==n?n:[])[0];null==c&&i(!1);var f=a.identifierField;return null!=f&&"string"!=typeof f&&i(!1),{connectionPathInFragmentData:l,identifierField:f,paginationRequest:s,paginationMetadata:u,stream:!0===c.stream}}var x=t.__internal.getPromiseForActiveRequest;function F(e){var t=D(e);return Array.isArray(e)?{snapshot:e,data:e.map((function(e){return e.data})),isMissingData:t}:{snapshot:e,data:e.data,isMissingData:t}}function D(e){return Array.isArray(e)?e.some((function(e){return e.isMissingData})):e.isMissingData}var E=function(){function e(e){var r=this;this.unmounted=!1,this.refetchable=!1,this.pagination=!1,this.refetch=function(e,n){var o,i,s,a;if(!0===r.unmounted)return{dispose:function(){}};var c,f,h=q(r._fragment),p=h.fragmentRefPathInResponse,d=h.identifierField,v=h.refetchableRequest,g=r.getData().data,m=null!=d&&null!=g&&"object"==typeof g?g[d]:null;null==r._selector?(c={},f={}):"PluralReaderSelector"===r._selector.kind?(c=null!==(i=null===(o=r._selector.selectors[0])||void 0===o?void 0:o.owner.variables)&&void 0!==i?i:{},f=null!==(a=null===(s=r._selector.selectors[0])||void 0===s?void 0:s.variables)&&void 0!==a?a:{}):(c=r._selector.owner.variables,f=r._selector.variables);var b=_(_(_({},c),f),e);null==d||e.hasOwnProperty("id")||(b.id=m),r.pagination&&(r.fetcherNext.dispose(),r.fetcherPrevious.dispose());var y=l(v,b,u);return r.fetcherRefecth.fetch(r._environment,y,null==n?void 0:n.fetchPolicy,null==n?void 0:n.onComplete,(function(e,n){var o=P(n.data,p),i=r.isEqualsFragmentRef(r._fragmentRefRefetch||r._fragmentRef,o),s=D(n);i&&!s||(r._fragmentRefRefetch=o,r._idfragmentrefetch=t.getFragmentIdentifier(r._fragment,o),r.lookup(r._fragment,o),r.subscribe(),r.resolverData.isMissingData=s,r.resolverData.owner=e.request,r.refreshHooks())}),null==n?void 0:n.UNSTABLE_renderPolicy)},this.loadPrevious=function(e,t){return r.loadMore("backward",e,t)},this.loadNext=function(e,t){return r.loadMore("forward",e,t)},this.loadMore=function(e,t,n){var o,s=null!==(o=null==n?void 0:n.onComplete)&&void 0!==o?o:function(){},a=r.getData().data,c="backward"===e?r.fetcherPrevious:r.fetcherNext;if(!0===r.unmounted)return{dispose:function(){}};if(null==r._selector)return s(null),{dispose:function(){}};if(r._environment.isRequestActive(r._selector.owner.identifier)||!0===c.getData().isLoading||null==a)return s(null),{dispose:function(){}};(null==r._selector||"PluralReaderSelector"===r._selector.kind)&&i(!1);var f=w(r._fragment),h=f.paginationRequest,p=f.paginationMetadata,d=f.identifierField,v=f.connectionPathInFragmentData,g=null!=d&&null!=a&&"object"==typeof a?a[d]:null,m=r._selector.variables,b=null==n?void 0:n.UNSTABLE_extraVariables,y=_(_({},r._selector.owner.variables),m),R=function(e,t,r,n,o,s){var a,u,l=s.backward,c=s.forward;if("backward"===e){(null==l||null==l.count||null==l.cursor)&&i(!1);var f=_(_(_({},n),o),((a={})[l.cursor]=r,a[l.count]=t,a));return c&&c.cursor&&(f[c.cursor]=null),c&&c.count&&(f[c.count]=null),f}(null==c||null==c.count||null==c.cursor)&&i(!1);var h=_(_(_({},n),o),((u={})[c.cursor]=r,u[c.count]=t,u));return l&&l.cursor&&(h[l.cursor]=null),l&&l.count&&(h[l.count]=null),h}(e,t,function(e,t,r,n){return k(e,0,P(r,n))}(e,0,a,v).cursor,y,_({},b),p);null!=d&&(R.id=g);var q=l(h,R,u);return c.fetch(r._environment,q,void 0,s,(function(){}))},this.name=e,this.pagination="usePagination"===e,this.refetchable="useRefetchable"===e||this.pagination;var n=function(e){return r.refreshHooks()};this.refetchable&&(this.fetcherRefecth=f({setLoading:n,doRetain:!0})),this.pagination&&(this.fetcherNext=f({setLoading:n}),this.fetcherPrevious=f({setLoading:n}))}return e.prototype.setForceUpdate=function(e){var t=this;this.refreshHooks=function(){t.resolveResult(),e()}},e.prototype.setUnmounted=function(){this.unmounted=!0},e.prototype.isEqualsFragmentRef=function(e,r){if(this._fragmentRef!==r){var n=t.getDataIDsFromFragment(this._fragment,e),i=t.getDataIDsFromFragment(this._fragment,r);if(!o(n,i)||!o(this.getFragmentVariables(r),this.getFragmentVariables(e)))return!1}return!0},e.prototype.dispose=function(){this.unsubscribe(),this.fetcherNext&&this.fetcherNext.dispose(),this.fetcherPrevious&&this.fetcherPrevious.dispose(),this._idfragmentrefetch=null,this._fragmentRefRefetch=null,this.fetcherRefecth&&this.fetcherRefecth.dispose()},e.prototype.getFragmentVariables=function(e){return void 0===e&&(e=this._fragmentRef),t.getVariablesFromFragment(this._fragment,e)},e.prototype.resolve=function(e,t,r,n){(!this.resolverData||this._environment!==e||t!==this._idfragment&&(!this._idfragmentrefetch||this._idfragmentrefetch&&t!==this._idfragmentrefetch))&&(this._fragment=r,this._fragmentRef=n,this._idfragment=t,this._selector=null,this.dispose(),this._environment=e,this.lookup(r,this._fragmentRef),this.resolveResult())},e.prototype.lookup=function(e,r){if(null!=r)if(e.metadata&&e.metadata.plural&&!0===e.metadata.plural&&0===r.length)this.resolverData={data:[]};else{this._selector=t.getSelector(e,r);var n,o,i=(n=this._environment,"PluralReaderSelector"===(o=this._selector).kind?o.selectors.map((function(e){return n.lookup(e)})):n.lookup(o));this.resolverData=F(i),this.resolverData.owner=this._selector?"PluralReaderSelector"===this._selector.kind?this._selector.selectors[0].owner:this._selector.owner:null}else this.resolverData={data:null}},e.prototype.checkAndSuspense=function(e){var t,r=this;if(e&&this.resolverData.isMissingData&&this.resolverData.owner){var n=this.resolverData.owner,o=function(e,t){var r;return(null!==(r=x(t,e))&&void 0!==r?r:function(e,t){return e.getOperationTracker().getPromiseForPendingOperationsAffectingOwner(t)}(t,e))||null}(n,this._environment),i=null!==(t=n.node.params.name)&&void 0!==t?t:"Unknown Parent Query";if(null!=o){var s=o.then((function(){r._idfragmentrefetch?r.resolveResult():(r._idfragment=null,r.dispose())})).catch((function(e){r._idfragmentrefetch?r.resolveResult():(r._idfragment=null,r.dispose())}));throw s.displayName="Relay("+i+")",this.unsubscribe(),this.refreshHooks=function(){},s}}this.fetcherRefecth&&this.fetcherRefecth.checkAndSuspense(e)},e.prototype.getData=function(){return this.result},e.prototype.resolveResult=function(){var e=this.resolverData.data;if(this.refetchable||this.pagination){var t=this.fetcherRefecth.getData(),r=t.isLoading,n=t.error,o=this.refetch;if(!this.pagination)return void(this.result={data:e,isLoading:r,error:n,refetch:o});var i=P(e,w(this._fragment).connectionPathInFragmentData),s=k("forward",0,i).hasMore,a=k("backward",0,i).hasMore,u=this.fetcherNext.getData(),l=u.isLoading,c=u.error,f=this.fetcherPrevious.getData();this.result={data:e,hasNext:s,isLoadingNext:l,hasPrevious:a,isLoadingPrevious:f.isLoading,isLoading:r,errorNext:c,errorPrevious:f.error,error:n,refetch:o,loadNext:this.loadNext,loadPrevious:this.loadPrevious}}else this.result=e},e.prototype.unsubscribe=function(){this._disposable&&this._disposable.dispose()},e.prototype.subscribe=function(){var e=this,t=this._environment,r=this.resolverData.snapshot;this.unsubscribe();var n=[];r&&(Array.isArray(r)?r.forEach((function(r,o){n.push(t.subscribe(r,(function(t){e.resolverData.snapshot[o]=t,e.resolverData.data[o]=t.data,e.resolverData.isMissingData=!1,e.refreshHooks()})))})):n.push(t.subscribe(r,(function(t){e.resolverData=F(t),e.resolverData.isMissingData=!1,e.refreshHooks()})))),this._disposable={dispose:function(){n.map((function(e){return e.dispose()})),e._disposable=void 0}}},e}();function A(e,n,o,i){var s=m(),a=g(),u=r.useRef(null);null==u.current&&(u.current={resolver:new E(i)});var l=u.current.resolver;r.useEffect((function(){return function(){u.current.resolver.setUnmounted()}}),[]),r.useEffect((function(){return function(){l.dispose()}}),[l]);var c=r.useMemo((function(){return t.getFragment(e)}),[e]),f=r.useMemo((function(){return t.getFragmentIdentifier(c,n)}),[c,n]);return r.useEffect((function(){return l.subscribe(),function(){l.unsubscribe()}}),[l,f,s]),l.resolve(s,f,c,n),l.checkAndSuspense(o),l.setForceUpdate(a),[l.getData(),l]}var S=n.useCallback,M=n.useState;Object.defineProperty(exports,"applyOptimisticMutation",{enumerable:!0,get:function(){return t.applyOptimisticMutation}}),Object.defineProperty(exports,"commitLocalUpdate",{enumerable:!0,get:function(){return t.commitLocalUpdate}}),Object.defineProperty(exports,"commitMutation",{enumerable:!0,get:function(){return t.commitMutation}}),Object.defineProperty(exports,"fetchQuery",{enumerable:!0,get:function(){return t.fetchQuery}}),Object.defineProperty(exports,"graphql",{enumerable:!0,get:function(){return t.graphql}}),Object.defineProperty(exports,"requestSubscription",{enumerable:!0,get:function(){return t.requestSubscription}}),exports.FORWARD="forward",exports.FRAGMENT_NAME="useFragment",exports.NETWORK_ONLY="network-only",exports.PAGINATION_NAME="usePagination",exports.REFETCHABLE_NAME="useRefetchable",exports.ReactRelayContext=a,exports.RelayEnvironmentProvider=function(e){var t=n.useMemo((function(){return{environment:e.environment}}),[e.environment]);return n.createElement(a.Provider,{value:t},e.children)},exports.STORE_ONLY="store-only",exports.STORE_OR_NETWORK="store-or-network",exports.STORE_THEN_NETWORK="store-and-network",exports.loadLazyQuery=function(){return R(!0)},exports.loadQuery=function(){return R(!1)},exports.useFragment=function(e,t){return A(e,t,!1,"useFragment")[0]},exports.useLazyLoadQuery=function(e,t,r){var n;return void 0===t&&(t={}),void 0===r&&(r={}),r.networkCacheConfig=null!==(n=r.networkCacheConfig)&&void 0!==n?n:u,b(e,t,r,!0)},exports.useMutation=function(e,r,n){void 0===r&&(r={});var o=M({loading:!1,data:null,error:null}),a=o[0],u=o[1],l=s(),c=m(),f=n||c,h=r.configs,p=r.variables,d=r.uploadables,v=r.onCompleted,g=r.onError,b=r.optimisticUpdater,y=r.optimisticResponse,R=r.updater;return[S((function(r){var n=_({configs:h,variables:p,uploadables:d,onCompleted:v,onError:g,optimisticUpdater:b,optimisticResponse:y,updater:R},r);return n.variables||i(!1),l()&&u({loading:!0,data:n.optimisticResponse,error:null}),new Promise((function(r,o){function i(e){l()&&u({loading:!1,data:null,error:e}),n.onError?(n.onError(e),r(null)):o(e)}t.commitMutation(f,_(_({},n),{mutation:e,variables:n.variables,onCompleted:function(e,t){t?i(t):(l()&&u({loading:!1,data:e,error:null}),n.onCompleted&&n.onCompleted(e),r(e))},onError:i}))}))}),[f,h,e,p,d,v,g,b,y,R,l]),a]},exports.useOssFragment=A,exports.usePagination=function(e,t){return A(e,t,!1,"usePagination")[0]},exports.usePaginationFragment=function(e,t){return A(e,t,!0,"usePagination")[0]},exports.usePreloadedQuery=function(e){var t=g(),n=m();return r.useEffect((function(){return e.subscribe(t)}),[e]),e.getValue(n)},exports.useQuery=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),b(e,t,r,!1)},exports.useRefetchable=function(e,t){return A(e,t,!1,"useRefetchable")[0]},exports.useRefetchableFragment=function(e,t){return A(e,t,!0,"useRefetchable")[0]},exports.useRelayEnvironment=m,exports.useSubscription=function(e,n){var o=m(),i=n&&n.skip;r.useEffect((function(){if(!i)return t.requestSubscription(o,e).dispose}),[o,e,i])},exports.useSuspenseFragment=function(e,t){return A(e,t,!0,"useFragment")[0]};
//# sourceMappingURL=cjs-relay-hooks.min.js.map
