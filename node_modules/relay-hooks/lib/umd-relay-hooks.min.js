!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("relay-runtime"),require("react"),require("fbjs/lib/areEqual"),require("fbjs/lib/warning"),require("fbjs/lib/invariant"),require("@restart/hooks/useMounted")):"function"==typeof define&&define.amd?define(["exports","relay-runtime","react","fbjs/lib/areEqual","fbjs/lib/warning","fbjs/lib/invariant","@restart/hooks/useMounted"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self)["relay-hooks"]={},e.relayRuntime,e.React,e.areEqual,e.warning,e.invariant,e.useMounted)}(this,(function(e,t,r,n,i,o,s){"use strict";var a="default"in r?r.default:r;n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s;var u=(0,t.__internal.createRelayContext)(a),l={force:!0};function c(e,r,n){return t.createOperationDescriptor(t.getRequest(e),r,n)}var f=t.__internal.fetchQuery;function h(e){var t,r,n,i,o=e.setLoading,s=e.doRetain,a=void 0===s||s,u=e.disposeTemporary,l=null,c=null,h=!1,d=null,p=function(e){h=e,o&&o(h)},v=function(){g(),c&&c.dispose(),m(),c=null,i=null,r=null},g=function(){clearTimeout(t),t=null},m=function(){l&&l.unsubscribe(),d=null};return{fetch:function(e,t,o,s,u,g){void 0===o&&(o="network-only"),void 0===s&&(s=function(e){}),i==e&&r.request.identifier===t.request.identifier||(v(),a&&(c=e.retain(t))),i=e,r=t,m();var b,y=function(e,t,r,n){if("network-only"!==r){var i=e.check(t).status,o="available"===i;if(o||"partial"===n&&"stale"!==i)return{snapshot:e.lookup(t.fragment),full:o}}return{snapshot:null,full:!1}}(e,t,o,g),R=y.snapshot,_="network-only"===(b=o)||"store-and-network"===b||"store-or-network"===b&&!y.full;if(null!=R){var P=!_;u(t,R,!0,P),P&&s(null)}if(l&&l.unsubscribe(),_){var k,w=function(){},q=function(){l===k&&(l=null),h=!1,n=null};return f(e,t).subscribe({unsubscribe:function(){q()},complete:function(){w(),p(!1),q(),s(null)},error:function(e){d=e,w(),p(!1),q(),s(e)},next:function(){var r,i=e.lookup(t.fragment);n=null,(null===(r=t.request.cacheConfig)||void 0===r?void 0:r.poll)&&p(!1),w(),u(t,i)},start:function(e){l=k=e,p(!0)}}),R||(n=new Promise((function(e){w=e}))),{dispose:function(){k&&k.unsubscribe()}}}return{dispose:function(){}}},getData:function(){return{isLoading:h,error:d}},dispose:v,checkAndSuspense:function(e,r){g();var i=n||d;if(e&&i)throw n&&r&&(t=setTimeout((function(){g(),v(),u&&u()}),3e4)),i;return i}}}var d=new Map;function p(e,t,r,n){var i=c(t,r,n),o=e&&d.has(i.request.identifier)?d.get(i.request.identifier):new g;return o.setQuery(t,r,n,i),o}var v=function(){},g=function(){function e(){var e=this;this.forceUpdate=v,this.result=null,this.retry=function(t,r){void 0===r&&(r={});var n=r.fetchPolicy,i=void 0===n?"network-only":n,o=t?c(e.query.request.node,e.query.request.variables,t):e.query;e.fetch(o,i,r),e.resolveResult(),e.forceUpdate()},this.result={retry:this.retry,error:null,data:null,isLoading:!1},this.fetcher=h({disposeTemporary:function(){e.dispose(),e.query&&d.delete(e.query.request.identifier)}})}return e.prototype.setQuery=function(e,t,r,n){this.gqlQuery=e,this.variables=t,this.query=n,this.cacheConfig=r},e.prototype.getForceUpdate=function(){return this.forceUpdate},e.prototype.setForceUpdate=function(e){this.forceUpdate=e},e.prototype.dispose=function(){this.fetcher.dispose(),this.disposeSnapshot()},e.prototype.disposeSnapshot=function(){this.snapshot=null,this.rootSubscription&&(this.rootSubscription.dispose(),this.rootSubscription=null)},e.prototype.fetch=function(e,t,r,n){var i=this;if(this.disposeSnapshot(),n)this.fetcher.dispose();else{var o=r.onComplete,s=!1;this.fetcher.fetch(this.environment,e,t,(function(e){i.resolveResult(),s&&i.forceUpdate(),o&&o(e)}),(function(e,t){i.snapshot||(i.snapshot=t,i.subscribe(t),i.resolveResult(),s&&i.forceUpdate())})),s=!0}},e.prototype.getQuery=function(e,t,r){return e==this.gqlQuery&&r==this.cacheConfig&&t==this.variables&&n(t,this.variables)?this.query:(this.variables=t,this.gqlQuery=e,this.cacheConfig=r,c(e,t,r))},e.prototype.resolveEnvironment=function(e){this.resolve(e,this.gqlQuery,this.variables,this.options)},e.prototype.resolve=function(e,t,r,n){var i=this.getQuery(t,r,n.networkCacheConfig),o=n.fetchPolicy,s=void 0===o?"store-or-network":o,a=n.fetchKey,u=n.skip;this.options=n,(!this.query||i.request.identifier!==this.query.request.identifier||e!==this.environment||s!==this.fetchPolicy||a!==this.fetchKey||u!==this.skip)&&(this.environment=e,this.query=i,this.skip=u,this.fetchPolicy=s,this.fetchKey=a,this.fetch(i,s,n,u),this.resolveResult())},e.prototype.checkAndSuspense=function(e,t){t&&(this.setForceUpdate(v),d.set(this.query.request.identifier,this));var r=this.fetcher.checkAndSuspense(e,t);return t&&d.delete(this.query.request.identifier),r},e.prototype.getData=function(){return this.result},e.prototype.resolveResult=function(){var e=this.fetcher.getData();this.result={retry:this.retry,error:e.error,data:this.snapshot?this.snapshot.data:null,isLoading:e.isLoading}},e.prototype.subscribe=function(e){var t=this;this.rootSubscription&&this.rootSubscription.dispose(),this.rootSubscription=this.environment.subscribe(e,(function(e){t.snapshot=e,t.resolveResult(),t.forceUpdate()}))},e}();function m(){return r.useReducer((function(e){return e+1}),0)[1]}function b(){return a.useContext(u).environment}var y=function(e,t,n,i){var o=b(),s=m(),a=r.useRef();null==a.current&&(a.current={queryFetcher:p(i,e,t,n.networkCacheConfig)}),r.useEffect((function(){return function(){return a.current.queryFetcher.dispose()}}),[]);var u=a.current.queryFetcher;return u.resolve(o,e,t,n),u.checkAndSuspense(i,i),u.setForceUpdate(s),u.getData()},R=function(){},_=function(e){void 0===e&&(e=!1);var t=new g;return{next:function(e,r,n,i){var o;void 0===n&&(n={}),void 0===i&&(i={}),i.networkCacheConfig=null!==(o=i.networkCacheConfig)&&void 0!==o?o:l,t.resolve(e,r,n,i);var s=t.checkAndSuspense();return s?s instanceof Error?Promise.reject(s):s:Promise.resolve()},subscribe:function(e){return t.setForceUpdate(e),function(){t.getForceUpdate()===e&&t.setForceUpdate(R)}},getValue:function(r){return t.resolveEnvironment(r),t.checkAndSuspense(e),t.getData()},dispose:function(){t.dispose(),t.setForceUpdate(R),t=new g}}},P=function(){return(P=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var i in t=arguments[r])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function k(e,t){for(var r=e,n=0,i=t;n<i.length;n++){var s=i[n];if(null==r)return null;"number"==typeof s?(Array.isArray(r)||o(!1),r=r[s]):(("object"!=typeof r||Array.isArray(r))&&o(!1),r=r[s])}return r}function w(e,r,n){var i,s;if(null==n)return{cursor:null,hasMore:!1};var a=t.ConnectionInterface.get(),u=a.EDGES,l=a.PAGE_INFO,c=a.HAS_NEXT_PAGE,f=a.HAS_PREV_PAGE,h=a.END_CURSOR,d=a.START_CURSOR;"object"!=typeof n&&o(!1);var p=n[u],v=n[l];if(null==p||null==v)return{cursor:null,hasMore:!1};Array.isArray(p)||o(!1),"object"!=typeof v&&o(!1);var g="forward"===e?null!==(i=v[h])&&void 0!==i?i:null:null!==(s=v[d])&&void 0!==s?s:null;return null!==g&&"string"!=typeof g&&o(!1),{cursor:g,hasMore:"forward"===e?null!=g&&!0===v[c]:null!=g&&!0===v[f]}}function q(e,t){var r,n;!0===(null===(r=e.metadata)||void 0===r?void 0:r.plural)&&o(!1);var i=null===(n=e.metadata)||void 0===n?void 0:n.refetch;null==i&&o(!1);var s=i.operation.default?i.operation.default:i.operation,a=i.fragmentPathInResult;"string"==typeof s&&o(!1);var u=i.identifierField;return null!=u&&"string"!=typeof u&&o(!1),{fragmentRefPathInResponse:a,identifierField:u,refetchableRequest:s,refetchMetadata:i}}function F(e,t){var r,n,i=q(e),s=i.refetchableRequest,a=i.refetchMetadata,u=a.connection;null==u&&o(!1);var l=u.path,c=(null!==(n=null===(r=e.metadata)||void 0===r?void 0:r.connection)&&void 0!==n?n:[])[0];null==c&&o(!1);var f=a.identifierField;return null!=f&&"string"!=typeof f&&o(!1),{connectionPathInFragmentData:l,identifierField:f,paginationRequest:s,paginationMetadata:u,stream:!0===c.stream}}var D=t.__internal.getPromiseForActiveRequest;function E(e){var t=A(e);return Array.isArray(e)?{snapshot:e,data:e.map((function(e){return e.data})),isMissingData:t}:{snapshot:e,data:e.data,isMissingData:t}}function A(e){return Array.isArray(e)?e.some((function(e){return e.isMissingData})):e.isMissingData}var O=function(){function e(e){var r=this;this.unmounted=!1,this.refetchable=!1,this.pagination=!1,this.refetch=function(e,n){var i,o,s,a;if(!0===r.unmounted)return{dispose:function(){}};var u,f,h=q(r._fragment),d=h.fragmentRefPathInResponse,p=h.identifierField,v=h.refetchableRequest,g=r.getData().data,m=null!=p&&null!=g&&"object"==typeof g?g[p]:null;null==r._selector?(u={},f={}):"PluralReaderSelector"===r._selector.kind?(u=null!==(o=null===(i=r._selector.selectors[0])||void 0===i?void 0:i.owner.variables)&&void 0!==o?o:{},f=null!==(a=null===(s=r._selector.selectors[0])||void 0===s?void 0:s.variables)&&void 0!==a?a:{}):(u=r._selector.owner.variables,f=r._selector.variables);var b=P(P(P({},u),f),e);null==p||e.hasOwnProperty("id")||(b.id=m),r.pagination&&(r.fetcherNext.dispose(),r.fetcherPrevious.dispose());var y=c(v,b,l);return r.fetcherRefecth.fetch(r._environment,y,null==n?void 0:n.fetchPolicy,null==n?void 0:n.onComplete,(function(e,n){var i=k(n.data,d),o=r.isEqualsFragmentRef(r._fragmentRefRefetch||r._fragmentRef,i),s=A(n);o&&!s||(r._fragmentRefRefetch=i,r._idfragmentrefetch=t.getFragmentIdentifier(r._fragment,i),r.lookup(r._fragment,i),r.subscribe(),r.resolverData.isMissingData=s,r.resolverData.owner=e.request,r.refreshHooks())}),null==n?void 0:n.UNSTABLE_renderPolicy)},this.loadPrevious=function(e,t){return r.loadMore("backward",e,t)},this.loadNext=function(e,t){return r.loadMore("forward",e,t)},this.loadMore=function(e,t,n){var i,s=null!==(i=null==n?void 0:n.onComplete)&&void 0!==i?i:function(){},a=r.getData().data,u="backward"===e?r.fetcherPrevious:r.fetcherNext;if(!0===r.unmounted)return{dispose:function(){}};if(null==r._selector)return s(null),{dispose:function(){}};if(r._environment.isRequestActive(r._selector.owner.identifier)||!0===u.getData().isLoading||null==a)return s(null),{dispose:function(){}};(null==r._selector||"PluralReaderSelector"===r._selector.kind)&&o(!1);var f=F(r._fragment),h=f.paginationRequest,d=f.paginationMetadata,p=f.identifierField,v=f.connectionPathInFragmentData,g=null!=p&&null!=a&&"object"==typeof a?a[p]:null,m=r._selector.variables,b=null==n?void 0:n.UNSTABLE_extraVariables,y=P(P({},r._selector.owner.variables),m),R=function(e,t,r,n,i,s){var a,u,l=s.backward,c=s.forward;if("backward"===e){(null==l||null==l.count||null==l.cursor)&&o(!1);var f=P(P(P({},n),i),((a={})[l.cursor]=r,a[l.count]=t,a));return c&&c.cursor&&(f[c.cursor]=null),c&&c.count&&(f[c.count]=null),f}(null==c||null==c.count||null==c.cursor)&&o(!1);var h=P(P(P({},n),i),((u={})[c.cursor]=r,u[c.count]=t,u));return l&&l.cursor&&(h[l.cursor]=null),l&&l.count&&(h[l.count]=null),h}(e,t,function(e,t,r,n){return w(e,0,k(r,n))}(e,0,a,v).cursor,y,P({},b),d);null!=p&&(R.id=g);var _=c(h,R,l);return u.fetch(r._environment,_,void 0,s,(function(){}))},this.name=e,this.pagination="usePagination"===e,this.refetchable="useRefetchable"===e||this.pagination;var n=function(e){return r.refreshHooks()};this.refetchable&&(this.fetcherRefecth=h({setLoading:n,doRetain:!0})),this.pagination&&(this.fetcherNext=h({setLoading:n}),this.fetcherPrevious=h({setLoading:n}))}return e.prototype.setForceUpdate=function(e){var t=this;this.refreshHooks=function(){t.resolveResult(),e()}},e.prototype.setUnmounted=function(){this.unmounted=!0},e.prototype.isEqualsFragmentRef=function(e,r){if(this._fragmentRef!==r){var i=t.getDataIDsFromFragment(this._fragment,e),o=t.getDataIDsFromFragment(this._fragment,r);if(!n(i,o)||!n(this.getFragmentVariables(r),this.getFragmentVariables(e)))return!1}return!0},e.prototype.dispose=function(){this.unsubscribe(),this.fetcherNext&&this.fetcherNext.dispose(),this.fetcherPrevious&&this.fetcherPrevious.dispose(),this._idfragmentrefetch=null,this._fragmentRefRefetch=null,this.fetcherRefecth&&this.fetcherRefecth.dispose()},e.prototype.getFragmentVariables=function(e){return void 0===e&&(e=this._fragmentRef),t.getVariablesFromFragment(this._fragment,e)},e.prototype.resolve=function(e,t,r,n){(!this.resolverData||this._environment!==e||t!==this._idfragment&&(!this._idfragmentrefetch||this._idfragmentrefetch&&t!==this._idfragmentrefetch))&&(this._fragment=r,this._fragmentRef=n,this._idfragment=t,this._selector=null,this.dispose(),this._environment=e,this.lookup(r,this._fragmentRef),this.resolveResult())},e.prototype.lookup=function(e,r){if(null!=r)if(e.metadata&&e.metadata.plural&&!0===e.metadata.plural&&0===r.length)this.resolverData={data:[]};else{this._selector=t.getSelector(e,r);var n,i,o=(n=this._environment,"PluralReaderSelector"===(i=this._selector).kind?i.selectors.map((function(e){return n.lookup(e)})):n.lookup(i));this.resolverData=E(o),this.resolverData.owner=this._selector?"PluralReaderSelector"===this._selector.kind?this._selector.selectors[0].owner:this._selector.owner:null}else this.resolverData={data:null}},e.prototype.checkAndSuspense=function(e){var t,r=this;if(e&&this.resolverData.isMissingData&&this.resolverData.owner){var n=this.resolverData.owner,i=function(e,t){var r;return(null!==(r=D(t,e))&&void 0!==r?r:function(e,t){return e.getOperationTracker().getPromiseForPendingOperationsAffectingOwner(t)}(t,e))||null}(n,this._environment),o=null!==(t=n.node.params.name)&&void 0!==t?t:"Unknown Parent Query";if(null!=i){var s=i.then((function(){r._idfragmentrefetch?r.resolveResult():(r._idfragment=null,r.dispose())})).catch((function(e){r._idfragmentrefetch?r.resolveResult():(r._idfragment=null,r.dispose())}));throw s.displayName="Relay("+o+")",this.unsubscribe(),this.refreshHooks=function(){},s}}this.fetcherRefecth&&this.fetcherRefecth.checkAndSuspense(e)},e.prototype.getData=function(){return this.result},e.prototype.resolveResult=function(){var e=this.resolverData.data;if(this.refetchable||this.pagination){var t=this.fetcherRefecth.getData(),r=t.isLoading,n=t.error,i=this.refetch;if(!this.pagination)return void(this.result={data:e,isLoading:r,error:n,refetch:i});var o=k(e,F(this._fragment).connectionPathInFragmentData),s=w("forward",0,o).hasMore,a=w("backward",0,o).hasMore,u=this.fetcherNext.getData(),l=u.isLoading,c=u.error,f=this.fetcherPrevious.getData();this.result={data:e,hasNext:s,isLoadingNext:l,hasPrevious:a,isLoadingPrevious:f.isLoading,isLoading:r,errorNext:c,errorPrevious:f.error,error:n,refetch:i,loadNext:this.loadNext,loadPrevious:this.loadPrevious}}else this.result=e},e.prototype.unsubscribe=function(){this._disposable&&this._disposable.dispose()},e.prototype.subscribe=function(){var e=this,t=this._environment,r=this.resolverData.snapshot;this.unsubscribe();var n=[];r&&(Array.isArray(r)?r.forEach((function(r,i){n.push(t.subscribe(r,(function(t){e.resolverData.snapshot[i]=t,e.resolverData.data[i]=t.data,e.resolverData.isMissingData=!1,e.refreshHooks()})))})):n.push(t.subscribe(r,(function(t){e.resolverData=E(t),e.resolverData.isMissingData=!1,e.refreshHooks()})))),this._disposable={dispose:function(){n.map((function(e){return e.dispose()})),e._disposable=void 0}}},e}();function S(e,n,i,o){var s=b(),a=m(),u=r.useRef(null);null==u.current&&(u.current={resolver:new O(o)});var l=u.current.resolver;r.useEffect((function(){return function(){u.current.resolver.setUnmounted()}}),[]),r.useEffect((function(){return function(){l.dispose()}}),[l]);var c=r.useMemo((function(){return t.getFragment(e)}),[e]),f=r.useMemo((function(){return t.getFragmentIdentifier(c,n)}),[c,n]);return r.useEffect((function(){return l.subscribe(),function(){l.unsubscribe()}}),[l,f,s]),l.resolve(s,f,c,n),l.checkAndSuspense(i),l.setForceUpdate(a),[l.getData(),l]}var M=a.useCallback,C=a.useState;Object.defineProperty(e,"applyOptimisticMutation",{enumerable:!0,get:function(){return t.applyOptimisticMutation}}),Object.defineProperty(e,"commitLocalUpdate",{enumerable:!0,get:function(){return t.commitLocalUpdate}}),Object.defineProperty(e,"commitMutation",{enumerable:!0,get:function(){return t.commitMutation}}),Object.defineProperty(e,"fetchQuery",{enumerable:!0,get:function(){return t.fetchQuery}}),Object.defineProperty(e,"graphql",{enumerable:!0,get:function(){return t.graphql}}),Object.defineProperty(e,"requestSubscription",{enumerable:!0,get:function(){return t.requestSubscription}}),e.FORWARD="forward",e.FRAGMENT_NAME="useFragment",e.NETWORK_ONLY="network-only",e.PAGINATION_NAME="usePagination",e.REFETCHABLE_NAME="useRefetchable",e.ReactRelayContext=u,e.RelayEnvironmentProvider=function(e){var t=a.useMemo((function(){return{environment:e.environment}}),[e.environment]);return a.createElement(u.Provider,{value:t},e.children)},e.STORE_ONLY="store-only",e.STORE_OR_NETWORK="store-or-network",e.STORE_THEN_NETWORK="store-and-network",e.loadLazyQuery=function(){return _(!0)},e.loadQuery=function(){return _(!1)},e.useFragment=function(e,t){return S(e,t,!1,"useFragment")[0]},e.useLazyLoadQuery=function(e,t,r){var n;return void 0===t&&(t={}),void 0===r&&(r={}),r.networkCacheConfig=null!==(n=r.networkCacheConfig)&&void 0!==n?n:l,y(e,t,r,!0)},e.useMutation=function(e,r,n){void 0===r&&(r={});var i=C({loading:!1,data:null,error:null}),a=i[0],u=i[1],l=s(),c=b(),f=n||c,h=r.configs,d=r.variables,p=r.uploadables,v=r.onCompleted,g=r.onError,m=r.optimisticUpdater,y=r.optimisticResponse,R=r.updater;return[M((function(r){var n=P({configs:h,variables:d,uploadables:p,onCompleted:v,onError:g,optimisticUpdater:m,optimisticResponse:y,updater:R},r);return n.variables||o(!1),l()&&u({loading:!0,data:n.optimisticResponse,error:null}),new Promise((function(r,i){function o(e){l()&&u({loading:!1,data:null,error:e}),n.onError?(n.onError(e),r(null)):i(e)}t.commitMutation(f,P(P({},n),{mutation:e,variables:n.variables,onCompleted:function(e,t){t?o(t):(l()&&u({loading:!1,data:e,error:null}),n.onCompleted&&n.onCompleted(e),r(e))},onError:o}))}))}),[f,h,e,d,p,v,g,m,y,R,l]),a]},e.useOssFragment=S,e.usePagination=function(e,t){return S(e,t,!1,"usePagination")[0]},e.usePaginationFragment=function(e,t){return S(e,t,!0,"usePagination")[0]},e.usePreloadedQuery=function(e){var t=m(),n=b();return r.useEffect((function(){return e.subscribe(t)}),[e]),e.getValue(n)},e.useQuery=function(e,t,r){return void 0===t&&(t={}),void 0===r&&(r={}),y(e,t,r,!1)},e.useRefetchable=function(e,t){return S(e,t,!1,"useRefetchable")[0]},e.useRefetchableFragment=function(e,t){return S(e,t,!0,"useRefetchable")[0]},e.useRelayEnvironment=b,e.useSubscription=function(e,n){var i=b(),o=n&&n.skip;r.useEffect((function(){if(!o)return t.requestSubscription(i,e).dispose}),[i,e,o])},e.useSuspenseFragment=function(e,t){return S(e,t,!0,"useFragment")[0]},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=umd-relay-hooks.min.js.map
